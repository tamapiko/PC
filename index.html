<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ブラウザでPCエミュレーター</title>
    <script src="js/libv86.js"></script>
</head>
<body>
    <h1>ブラウザでPCを動かす！</h1>

    <input type="file" id="iso_upload" />
    <div id="screen_container"></div>

    <script>
    window.onload = function() {
        if (typeof V86Starter === "undefined") {
            console.error("V86Starterが正しく読み込まれていません。libv86.jsのパスを確認してください。");
            return;
        }

        const emulator = new V86Starter({
            wasm_path: "js/v86.wasm",
            memory_size: 256 * 1024 * 1024,
            vga_memory_size: 8 * 1024 * 1024,
            bios: { url: "bios/seabios.bin" },
            vga_bios: { url: "bios/vgabios.bin" },
            screen_container: document.getElementById("screen_container"),
            autostart: true
        });

        document.getElementById("iso_upload").addEventListener("change", function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function() {
                    emulator.create_cdrom(reader.result);
                };
                reader.readAsArrayBuffer(file);
            }
        });
    }
    </script>
</body>
</html>
