<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ブラウザOS起動（修正版）</title>
  <style>
    body { margin: 0; background: #000; overflow: hidden; }
    #screen { width: 100vw; height: 100vh; background: #000; }
    #controls { position: absolute; top: 10px; left: 10px; z-index: 100; }
    #controls button { margin-right: 5px; padding: 5px 10px; }
  </style>
</head>
<body>
  <div id="controls">
    <input type="file" id="iso" accept=".iso">
    <button onclick="fullscreen()">全画面</button>
  </div>
  <canvas id="screen"></canvas>

  <script src="https://copy.v86.dev/libv86.js"></script>
  <script>
    const emulator = new V86Starter({
      wasm_path: "https://copy.v86.dev/v86.wasm",
      memory_size: 512 * 1024 * 1024, // 512MB
      vga_memory_size: 8 * 1024 * 1024,
      screen_container: document.getElementById("screen"),
      bios: { url: "https://copy.v86.dev/seabios.bin" },
      vga_bios: { url: "https://copy.v86.dev/vgabios.bin" },
      autostart: false,
    });

    document.getElementById("iso").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function() {
          emulator.create_cd(reader.result);
          emulator.run();
        };
        reader.readAsArrayBuffer(file);
      }
    });

    function fullscreen() {
      const canvas = document.getElementById("screen");
      if (canvas.requestFullscreen) {
        canvas.requestFullscreen();
      } else if (canvas.webkitRequestFullscreen) {
        canvas.webkitRequestFullscreen();
      }
    }
  </script>
</body>
</html>
